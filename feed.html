<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trusic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="assets/style.css" />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2563eb" />
<?php
include "db.php";
session_start();

$result = $conn->query("SELECT * FROM posts ORDER BY id DESC");
?>
  <style>
    /* Minimal modern polish */
    body { background:#f5f7fb; color:#0f172a; }
    body.dark { background:#0b1220; color:#e5e7eb; }
    .topbar { position:sticky; top:0; background:inherit; backdrop-filter: blur(10px); }
    .card { border-radius:16px; animation: fade .25s ease; }
    @keyframes fade { from { opacity:0; transform: translateY(6px);} }
    .toggle-dark { cursor:pointer; }
  </style>
</head>
<body>

<!-- ğŸ” Login Protection -->
<?php
session_start();
if (!isset($_SESSION["user"])) {
  header("Location: index.html");
  exit;
}
?>
<script>
function guest() {
  localStorage.setItem("currentUser", "Guest_" + Math.floor(Math.random()*9999));
  localStorage.setItem("isGuest", "true");
  window.location.href = "feed.html";
}
</script>
<script>
  const user = localStorage.getItem("currentUser");
  const isGuest = localStorage.getItem("isGuest") === "true";

  if (!user && !isGuest) {
    window.location.href = "index.html";
  }
</script>

<header class="topbar">
  <h1>Trusic</h1>
  <div class="top-actions">
    <a href="search.php">ğŸ”</a>
    <a href="notifications.php">ğŸ””</a>
    <span class="toggle-dark" onclick="toggleDark()">ğŸŒ™</span>
  </div>
</header>

<main class="container">

  <!-- Create Post -->
  <div class="card">
    <form action="upload.php" method="POST" enctype="multipart/form-data">
      <textarea name="content" placeholder="What happened today?" required></textarea>
      <select name="mood">
        <option value="happy">ğŸ˜„ Happy</option>
        <option value="tired">ğŸ˜´ Tired</option>
        <option value="motivated">ğŸ’ª Motivated</option>
      </select>
      <input type="text" name="location" placeholder="Where are you?" />
      <input type="file" name="media" />
      <label>
        <input type="checkbox" name="close_friends" value="1" />
        Close friends
      </label>
      <button>Post</button>
    </form>
  </div>

  <!-- Example Post (your real posts will come from PHP later) -->
  <div class="card">
    <b>@<span id="username"></span></b> Â· just now
    <p>Built my social app today ğŸ˜­ğŸ”¥</p>
    <img src="uploads/demo.jpg" alt="" style="width:100%;border-radius:12px" />

    <div class="post-actions">
      <a href="#">ğŸ‘</a>
      <a href="#">ğŸ”¥</a>
      <a href="#">ğŸ’¡</a>
      <a href="#">ğŸ’¬</a>
      <a href="#">ğŸ”</a>
      <a href="#">ğŸ”–</a>
      <a href="#">ğŸ“Œ</a>
    </div>
  </div>

  <!-- Pagination -->
  <div class="pager">
    <a href="?page=1">â† Prev</a>
    <a href="?page=2">Next â†’</a>
  </div>

</main>

<nav class="bottom-nav">
  <a href="feed.php">ğŸ <br>Feed</a>
  <a href="stories.php">ğŸ“¸<br>Stories</a>
  <a href="post.php">â•<br>Post</a>
  <a href="explore.php">ğŸ§­<br>Explore</a>
  <a href="profile.php">ğŸ‘¤<br>Profile</a>
</nav>
<?php while ($row = $result->fetch_assoc()): ?>
  <div class="card">
    <b>@<?= htmlspecialchars($row["user"]) ?></b>
    <p><?= nl2br(htmlspecialchars($row["content"])) ?></p>

    <?php if ($row["media"]): ?>
      <img src="<?= $row["media"] ?>" style="width:100%;border-radius:12px">
    <?php endif; ?>
  </div>
<?php endwhile; ?>

<script>
  // Username
  document.getElementById("username").innerText = localStorage.getItem("currentUser") || "guest";

  // Dark mode
  function toggleDark() {
    document.body.classList.toggle("dark");
    localStorage.setItem("darkMode", document.body.classList.contains("dark"));
  }
  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark");
  }

  // PWA
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>

</body>
</html>